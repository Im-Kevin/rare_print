import 'dart:convert';

import 'package:flutter_test/flutter_test.dart';
import 'package:rare_print/rare_print.dart';
import 'package:xml/xml.dart';

const testXml = r"""
<?xml version="1.0"?>
<page width="640" height="640">
    <font-type fontType="YaHei24" fontBaseWidth="32" fontBaseHeight="41"></font-type>
    <printer-config fontType="YaHei24" fontSize="1">
        <page-info gapmMM="2"/>
    </printer-config>
    <column x="30">
        <stack height="126">
            <image binding="data.brandImage" y="20"/>
            <text align="center" fontSize="2" y="76">产品标识卡</text>
        </stack>
        <column>
            <row height="50" y="30">
                <text width="90">品名:</text>
                <text binding="data.familyName"></text>
            </row>
            <row height="50" y="18">
                <row width="310">
                    <text width="90">型号:</text>
                    <text binding="data.familyStyleName"></text>
                </row>
                <row width="310">
                    <text width="90">颜色:</text>
                    <text binding="data.colorName"></text>
                </row>
            </row>
            <row height="50" y="18">
                <text width="90">规格:</text>
                <text binding="data.specName"></text>
            </row>
            <row>
                <column width="400">
                    <row height="50" y="18">
                        <text width="90">数量:</text>
                        <text binding="data.qty" width="auto"></text>
                        <text binding="data.um" width="100"></text>
                    </row>
                    <row height="50" y="18">
                        <text width="150">生产部门:</text>
                        <text binding="data.productionOu"></text>
                    </row>
                    <row height="50" y="18">
                        <text width="150">检 验 员:</text>
                        <text binding="data.inspectors"></text>
                    </row>
                    <row height="50" y="18">
                        <text width="150">生产日期:</text>
                        <text binding="data.date" format="yyyy年MM月dd日"></text>
                    </row>
                </column> 
                <column>
                    <qrcode 
                        binding="'123213' + data.uniqueCode"
                        width="200"
                        height="200" 
                        imagePaint="true"></qrcode>
                    <text width="200" height="50" y="22" align="center" binding="data.uniqueCode"></text>
                </column>
            </row>
        </column>
    </column>
</page>
""";

const dataSourceText = r"""{
    "uniqueCode": "string",
    "brand": {
      "id": 0,
      "code": "string",
      "name": "string",
      "logoPath": "string",
      "bytePath": "string",
      "width": 0,
      "height": 0,
      "isEffective": true
    },
    "familyId": 0,
    "familyStyleName": "string",
    "familyCode": "string",
    "familyName": "string",
    "um": "string",
    "merchandiseId": 0,
    "specName": "string",
    "colorName": "string",
    "merchandiseDescription": "string",
    "productionOu": "string",
    "inspectors": "string",
    "date": "2021-03-10T09:22:00.391Z",
    "qty": 0,
    "mediaInfos": [
      {
        "id": 0,
        "typeId": 0,
        "originalPath": "string",
        "normalPath": "string",
        "compactPath": "string",
        "displaySeqNr": 0
      }
    ]
  }""";

void main() {
  test('test 打印模板 - TSC', () {
    var command =
        '53495a45203832206d6d2c3832206d6d0d0a0d0a4741502032206d6d2c30206d6d0d0a0d0a444952454354494f4e20312c300d0a0d0a5245464552454e434520302c300d0a0d0a534554205445415220310d0a0d0a434c530d0a0d0a54455854203139302c38342c2259614865693234222c302c322c322c22b2fac6b7b1eacab6bfa8220d0a544558542033302c3136302c2259614865693234222c302c312c312c22c6b7c3fb3a220d0a54455854203132302c3136302c2259614865693234222c302c312c312c22737472696e67220d0a544558542033302c3232382c2259614865693234222c302c312c312c22d0cdbac53a220d0a54455854203132302c3232382c2259614865693234222c302c312c312c22737472696e67220d0a54455854203334302c3232382c2259614865693234222c302c312c312c22d1d5c9ab3a220d0a54455854203433302c3232382c2259614865693234222c302c312c312c22737472696e67220d0a544558542033302c3239362c2259614865693234222c302c312c312c22b9e6b8f13a220d0a54455854203132302c3239362c2259614865693234222c302c312c312c22737472696e67220d0a544558542033302c3336342c2259614865693234222c302c312c312c22cafdc1bf3a220d0a54455854203132302c3336342c2259614865693234222c302c312c312c2230220d0a54455854203133362c3336342c2259614865693234222c302c312c312c22737472696e67220d0a544558542033302c3433322c2259614865693234222c302c312c312c22c9fab2fab2bfc3c53a220d0a54455854203138302c3433322c2259614865693234222c302c312c312c22737472696e67220d0a544558542033302c3530302c2259614865693234222c302c312c312c22bcec20d1e920d4b13a220d0a54455854203138302c3530302c2259614865693234222c302c312c312c22737472696e67220d0a544558542033302c3536382c2259614865693234222c302c312c312c22c9fab2fac8d5c6da3a220d0a54455854203138302c3536382c2259614865693234222c302c312c312c2232303231c4ea3033d4c23130c8d5220d0a4249544d4150203433302c3334322c32352c3230302c302cffffffffffffffffffffffffffffffffffffffffffffffffff80000000001fffffff8000007ff8007fffe07ff8000000000180000000001fffffff8000007ff8007fffe07ff8000000000180000000001fffffff8000007ff8007fffe07ff8000000000180000000001fffffff8000007ff8007fffe07ff8000000000180000000001fffffff8000007ff8007fffe07ff8000000000180000000001fffffff8000007ff8007fffe07ff8000000000181fffffff81f81f81f81f8007fffe07e07e001f81fffffff8181fffffff81f81f81f81f8007fffe07e07e001f81fffffff8181fffffff81f81f81f81f8007fffe07e07e001f81fffffff8181fffffff81f81f81f81f8007fffe07e07e001f81fffffff8181fffffff81f81f81f81f8007fffe07e07e001f81fffffff8181fffffff81f81f81f81f8007fffe07e07e001f81fffffff8181f80001f81ffe07e07e001f81ffe07fffe07ff81f80001f8181f80001f81ffe07e07e001f81ffe07fffe07ff81f80001f8181f80001f81ffe07e07e001f81ffe07fffe07ff81f80001f8181f80001f81ffe07e07e001f81ffe07fffe07ff81f80001f8181f80001f81ffe07e07e001f81ffe07fffe07ff81f80001f8181f80001f81ffe07e07e001f81ffe07fffe07ff81f80001f8181f80001f81ffe07e000001f81f81f81f80001f81f80001f8181f80001f81ffe07e000001f81f81f81f80001f81f80001f8181f80001f81ffe07e000001f81f81f81f80001f81f80001f8181f80001f81ffe07e000001f81f81f81f80001f81f80001f8181f80001f81ffe07e000001f81f81f81f80001f81f80001f8181f80001f81ffe07e000001f81f81f81f80001f81f80001f8181f80001f81f81ffff81f81f81ffe07e07e07ff81f80001f8181f80001f81f81ffff81f81f81ffe07e07e07ff81f80001f8181f80001f81f81ffff81f81f81ffe07e07e07ff81f80001f8181f80001f81f81ffff81f81f81ffe07e07e07ff81f80001f8181f80001f81f81ffff81f81f81ffe07e07e07ff81f80001f8181f80001f81f81ffff81f81f81ffe07e07e07ff81f80001f8181fffffff81ffe00007e07e001ffe001ffe001f81fffffff8181fffffff81ffe00007e07e001ffe001ffe001f81fffffff8181fffffff81ffe00007e07e001ffe001ffe001f81fffffff8181fffffff81ffe00007e07e001ffe001ffe001f81fffffff8181fffffff81ffe00007e07e001ffe001ffe001f81fffffff8181fffffff81ffe00007e07e001ffe001ffe001f81fffffff8180000000001f81f81f81f81f81f81f81f81f81f8000000000180000000001f81f81f81f81f81f81f81f81f81f8000000000180000000001f81f81f81f81f81f81f81f81f81f8000000000180000000001f81f81f81f81f81f81f81f81f81f8000000000180000000001f81f81f81f81f81f81f81f81f81f8000000000180000000001f81f81f81f81f81f81f81f81f81f80000000001fffffffffffffe00000000007e00000007e07ffffffffffffffffffffffffffe00000000007e00000007e07ffffffffffffffffffffffffffe00000000007e00000007e07ffffffffffffffffffffffffffe00000000007e00000007e07ffffffffffffffffffffffffffe00000000007e00000007e07ffffffffffffffffffffffffffe00000000007e00000007e07fffffffffffff81f81f81f81ffe001ffe07ff8007e00007e001ffff81ffe07f81f81f81f81ffe001ffe07ff8007e00007e001ffff81ffe07f81f81f81f81ffe001ffe07ff8007e00007e001ffff81ffe07f81f81f81f81ffe001ffe07ff8007e00007e001ffff81ffe07f81f81f81f81ffe001ffe07ff8007e00007e001ffff81ffe07f81f81f81f81ffe001ffe07ff8007e00007e001ffff81ffe07ffe00000007e07ff81f8007ff8007fffe001f8000007fffff81fe00000007e07ff81f8007ff8007fffe001f8000007fffff81fe00000007e07ff81f8007ff8007fffe001f8000007fffff81fe00000007e07ff81f8007ff8007fffe001f8000007fffff81fe00000007e07ff81f8007ff8007fffe001f8000007fffff81fe00000007e07ff81f8007ff8007fffe001f8000007fffff81fff80001f80001ffe07ff81fffffffffffff8000007ff80001fff80001f80001ffe07ff81fffffffffffff8000007ff80001fff80001f80001ffe07ff81fffffffffffff8000007ff80001fff80001f80001ffe07ff81fffffffffffff8000007ff80001fff80001f80001ffe07ff81fffffffffffff8000007ff80001fff80001f80001ffe07ff81fffffffffffff8000007ff8000180001fffffe001f81f80001ffe07e000001f81ffff81ffffff80001fffffe001f81f80001ffe07e000001f81ffff81ffffff80001fffffe001f81f80001ffe07e000001f81ffff81ffffff80001fffffe001f81f80001ffe07e000001f81ffff81ffffff80001fffffe001f81f80001ffe07e000001f81ffff81ffffff80001fffffe001f81f80001ffe07e000001f81ffff81ffffff8007ff81f8000007ff81f81f8007fffe07e000001ffe07ffff8007ff81f8000007ff81f81f8007fffe07e000001ffe07ffff8007ff81f8000007ff81f81f8007fffe07e000001ffe07ffff8007ff81f8000007ff81f81f8007fffe07e000001ffe07ffff8007ff81f8000007ff81f81f8007fffe07e000001ffe07ffff8007ff81f8000007ff81f81f8007fffe07e000001ffe07ffff81f81f8007e07e07e001f80001f81ffe07ff81f81ffe07ff8181f81f8007e07e07e001f80001f81ffe07ff81f81ffe07ff8181f81f8007e07e07e001f80001f81ffe07ff81f81ffe07ff8181f81f8007e07e07e001f80001f81ffe07ff81f81ffe07ff8181f81f8007e07e07e001f80001f81ffe07ff81f81ffe07ff8181f81f8007e07e07e001f80001f81ffe07ff81f81ffe07ff818000007ff8000000000007e00007ffffffff8007e00007e0018000007ff8000000000007e00007ffffffff8007e00007e0018000007ff8000000000007e00007ffffffff8007e00007e0018000007ff8000000000007e00007ffffffff8007e00007e0018000007ff8000000000007e00007ffffffff8007e00007e0018000007ff8000000000007e00007ffffffff8007e00007e001ffffffffffe00007ff80001f8007e00007ff81f80001ffe07fffffffffffe00007ff80001f8007e00007ff81f80001ffe07fffffffffffe00007ff80001f8007e00007ff81f80001ffe07fffffffffffe00007ff80001f8007e00007ff81f80001ffe07fffffffffffe00007ff80001f8007e00007ff81f80001ffe07fffffffffffe00007ff80001f8007e00007ff81f80001ffe07ffe001ffff81f8007ffffffe000001f8007e000001ffffffffffe001ffff81f8007ffffffe000001f8007e000001ffffffffffe001ffff81f8007ffffffe000001f8007e000001ffffffffffe001ffff81f8007ffffffe000001f8007e000001ffffffffffe001ffff81f8007ffffffe000001f8007e000001ffffffffffe001ffff81f8007ffffffe000001f8007e000001fffffffff81ffff81ffe07e001f81f81f8007ff8007fffe00007fffe00181ffff81ffe07e001f81f81f8007ff8007fffe00007fffe00181ffff81ffe07e001f81f81f8007ff8007fffe00007fffe00181ffff81ffe07e001f81f81f8007ff8007fffe00007fffe00181ffff81ffe07e001f81f81f8007ff8007fffe00007fffe00181ffff81ffe07e001f81f81f8007ff8007fffe00007fffe0018007e00000007e07ff8007ff80001f81ffff80001ffff800018007e00000007e07ff8007ff80001f81ffff80001ffff800018007e00000007e07ff8007ff80001f81ffff80001ffff800018007e00000007e07ff8007ff80001f81ffff80001ffff800018007e00000007e07ff8007ff80001f81ffff80001ffff800018007e00000007e07ff8007ff80001f81ffff80001ffff800018007e07ffffffe00007ffffffe07e00000007ff80001ffe07f8007e07ffffffe00007ffffffe07e00000007ff80001ffe07f8007e07ffffffe00007ffffffe07e00000007ff80001ffe07f8007e07ffffffe00007ffffffe07e00000007ff80001ffe07f8007e07ffffffe00007ffffffe07e00000007ff80001ffe07f8007e07ffffffe00007ffffffe07e00000007ff80001ffe07ffe07fffe001f8000007e07ff8007ff81ffff81f81ffe07e001fe07fffe001f8000007e07ff8007ff81ffff81f81ffe07e001fe07fffe001f8000007e07ff8007ff81ffff81f81ffe07e001fe07fffe001f8000007e07ff8007ff81ffff81f81ffe07e001fe07fffe001f8000007e07ff8007ff81ffff81f81ffe07e001fe07fffe001f8000007e07ff8007ff81ffff81f81ffe07e001fe001fffffe07e00007e00007fffff81ffff81f81fffffe001fe001fffffe07e00007e00007fffff81ffff81f81fffffe001fe001fffffe07e00007e00007fffff81ffff81f81fffffe001fe001fffffe07e00007e00007fffff81ffff81f81fffffe001fe001fffffe07e00007e00007fffff81ffff81f81fffffe001fe001fffffe07e00007e00007fffff81ffff81f81fffffe00181ffe07e001fffffff80001ffe07ff81f81ffe001ffe00000181ffe07e001fffffff80001ffe07ff81f81ffe001ffe00000181ffe07e001fffffff80001ffe07ff81f81ffe001ffe00000181ffe07e001fffffff80001ffe07ff81f81ffe001ffe00000181ffe07e001fffffff80001ffe07ff81f81ffe001ffe00000181ffe07e001fffffff80001ffe07ff81f81ffe001ffe000001fe07e001ffe07ff8007ff81f80000000000001ffffffffe001fe07e001ffe07ff8007ff81f80000000000001ffffffffe001fe07e001ffe07ff8007ff81f80000000000001ffffffffe001fe07e001ffe07ff8007ff81f80000000000001ffffffffe001fe07e001ffe07ff8007ff81f80000000000001ffffffffe001fe07e001ffe07ff8007ff81f80000000000001ffffffffe00181ffe001f8007e07e07e001ffe07ff8007ff80000000001fff81ffe001f8007e07e07e001ffe07ff8007ff80000000001fff81ffe001f8007e07e07e001ffe07ff8007ff80000000001fff81ffe001f8007e07e07e001ffe07ff8007ff80000000001fff81ffe001f8007e07e07e001ffe07ff8007ff80000000001fff81ffe001f8007e07e07e001ffe07ff8007ff80000000001fffffffffffffff80001fffffff81ffff8007ff81ffff8007e001ffffffffffff80001fffffff81ffff8007ff81ffff8007e001ffffffffffff80001fffffff81ffff8007ff81ffff8007e001ffffffffffff80001fffffff81ffff8007ff81ffff8007e001ffffffffffff80001fffffff81ffff8007ff81ffff8007e001ffffffffffff80001fffffff81ffff8007ff81ffff8007e00180000000001fffffe001f81ffff81f80000001f81f81f8000180000000001fffffe001f81ffff81f80000001f81f81f8000180000000001fffffe001f81ffff81f80000001f81f81f8000180000000001fffffe001f81ffff81f80000001f81f81f8000180000000001fffffe001f81ffff81f80000001f81f81f8000180000000001fffffe001f81ffff81f80000001f81f81f8000181fffffff81ffe001ffff80000001f80001f81ffff81ffe00181fffffff81ffe001ffff80000001f80001f81ffff81ffe00181fffffff81ffe001ffff80000001f80001f81ffff81ffe00181fffffff81ffe001ffff80000001f80001f81ffff81ffe00181fffffff81ffe001ffff80000001f80001f81ffff81ffe00181fffffff81ffe001ffff80000001f80001f81ffff81ffe00181f80001f81f8007e07ff81f8007e00007ff8000000007e07f81f80001f81f8007e07ff81f8007e00007ff8000000007e07f81f80001f81f8007e07ff81f8007e00007ff8000000007e07f81f80001f81f8007e07ff81f8007e00007ff8000000007e07f81f80001f81f8007e07ff81f8007e00007ff8000000007e07f81f80001f81f8007e07ff81f8007e00007ff8000000007e07f81f80001f81ffe001ffe001f81ffff8007e001ffff81f81f8181f80001f81ffe001ffe001f81ffff8007e001ffff81f81f8181f80001f81ffe001ffe001f81ffff8007e001ffff81f81f8181f80001f81ffe001ffe001f81ffff8007e001ffff81f81f8181f80001f81ffe001ffe001f81ffff8007e001ffff81f81f8181f80001f81ffe001ffe001f81ffff8007e001ffff81f81f8181f80001f81f81f80001f81f81fffffff81f8007ff8007ff8181f80001f81f81f80001f81f81fffffff81f8007ff8007ff8181f80001f81f81f80001f81f81fffffff81f8007ff8007ff8181f80001f81f81f80001f81f81fffffff81f8007ff8007ff8181f80001f81f81f80001f81f81fffffff81f8007ff8007ff8181f80001f81f81f80001f81f81fffffff81f8007ff8007ff8181fffffff81ffe00007ff81f80001f80001f81f81f81ffe07f81fffffff81ffe00007ff81f80001f80001f81f81f81ffe07f81fffffff81ffe00007ff81f80001f80001f81f81f81ffe07f81fffffff81ffe00007ff81f80001f80001f81f81f81ffe07f81fffffff81ffe00007ff81f80001f80001f81f81f81ffe07f81fffffff81ffe00007ff81f80001f80001f81f81f81ffe07f80000000001f81f81ffff8000007e00007e00007ff8007e00180000000001f81f81ffff8000007e00007e00007ff8007e00180000000001f81f81ffff8000007e00007e00007ff8007e00180000000001f81f81ffff8000007e00007e00007ff8007e00180000000001f81f81ffff8000007e00007e00007ff8007e00180000000001f81f81ffff8000007e00007e00007ff8007e001ffffffffffffffffffffffffffffffffffffffffffffffffff0d0a54455854203438322c3536382c2259614865693234222c302c312c312c22737472696e67220d0a5052494e5420312c310d0a0d0a534f554e4420322c3130300d0a0d0a4341534844524157455220312c3235352c3235350d0a0d0a';

    final XmlDocument xml = XmlDocument.parse(testXml);

    var control = ControlBase.create(xml.rootElement);
    var dataObj = json.decode(dataSourceText);
    var dataSource = DataSource(dataObj);
    control.setDataSource(dataSource);

    TscCanvas canvas = TscCanvas();
    canvas.config = canvas.config!.copyWith(
        fontStyle: canvas.config!.fontStyle!.copyWith(fontType: 'FONT001'));
    control.performLayout(PrinterConstraints(maxWidth: 800), canvas);
    canvas.pageSize = control.actualSize;
    canvas.reset();

    control.paint(canvas, PrinterOffset.zero);

    var buffer = canvas.toCommand();

    var data = buffer.map((e) {
      var str = e.toRadixString(16);
      if (str.length == 1) {
        str = '0' + str;
      }
      return str;
    }).join();
    expect(command, data);
  });
  test('test 打印模板 - CPCL', () {
    var command =
        '5345544d4147203020300d0a534554424c4f4420300d0a554e4445524c494e45204f46460d0a5345544d4147203220320d0a54205961486569323420302031393020383420b2fac6b7b1eacab6bfa80d0a5345544d4147203120310d0a54205961486569323420302033302031363020c6b7c3fb3a0d0a5420596148656932342030203132302031363020737472696e670d0a54205961486569323420302033302032323820d0cdbac53a0d0a5420596148656932342030203132302032323820737472696e670d0a5420596148656932342030203334302032323820d1d5c9ab3a0d0a5420596148656932342030203433302032323820737472696e670d0a54205961486569323420302033302032393620b9e6b8f13a0d0a5420596148656932342030203132302032393620737472696e670d0a54205961486569323420302033302033363420cafdc1bf3a0d0a5420596148656932342030203132302033363420300d0a5420596148656932342030203133362033363420737472696e670d0a54205961486569323420302033302034333220c9fab2fab2bfc3c53a0d0a5420596148656932342030203138302034333220737472696e670d0a54205961486569323420302033302035303020bcec20d1e920d4b13a0d0a5420596148656932342030203138302035303020737472696e670d0a54205961486569323420302033302035363820c9fab2fac8d5c6da3a0d0a542059614865693234203020313830203536382032303231c4ea3033d4c23130c8d50d0a434720323520323030203433302033343220000000000000000000000000000000000000000000000000007fffffffffe00000007fffff8007ff80001f8007fffffffffe7fffffffffe00000007fffff8007ff80001f8007fffffffffe7fffffffffe00000007fffff8007ff80001f8007fffffffffe7fffffffffe00000007fffff8007ff80001f8007fffffffffe7fffffffffe00000007fffff8007ff80001f8007fffffffffe7fffffffffe00000007fffff8007ff80001f8007fffffffffe7e00000007e07e07e07e07ff80001f81f81ffe07e00000007e7e00000007e07e07e07e07ff80001f81f81ffe07e00000007e7e00000007e07e07e07e07ff80001f81f81ffe07e00000007e7e00000007e07e07e07e07ff80001f81f81ffe07e00000007e7e00000007e07e07e07e07ff80001f81f81ffe07e00000007e7e00000007e07e07e07e07ff80001f81f81ffe07e00000007e7e07fffe07e001f81f81ffe07e001f80001f8007e07fffe07e7e07fffe07e001f81f81ffe07e001f80001f8007e07fffe07e7e07fffe07e001f81f81ffe07e001f80001f8007e07fffe07e7e07fffe07e001f81f81ffe07e001f80001f8007e07fffe07e7e07fffe07e001f81f81ffe07e001f80001f8007e07fffe07e7e07fffe07e001f81f81ffe07e001f80001f8007e07fffe07e7e07fffe07e001f81fffffe07e07e07e07fffe07e07fffe07e7e07fffe07e001f81fffffe07e07e07e07fffe07e07fffe07e7e07fffe07e001f81fffffe07e07e07e07fffe07e07fffe07e7e07fffe07e001f81fffffe07e07e07e07fffe07e07fffe07e7e07fffe07e001f81fffffe07e07e07e07fffe07e07fffe07e7e07fffe07e001f81fffffe07e07e07e07fffe07e07fffe07e7e07fffe07e07e00007e07e07e001f81f81f8007e07fffe07e7e07fffe07e07e00007e07e07e001f81f81f8007e07fffe07e7e07fffe07e07e00007e07e07e001f81f81f8007e07fffe07e7e07fffe07e07e00007e07e07e001f81f81f8007e07fffe07e7e07fffe07e07e00007e07e07e001f81f81f8007e07fffe07e7e07fffe07e07e00007e07e07e001f81f81f8007e07fffe07e7e00000007e001ffff81f81ffe001ffe001ffe07e00000007e7e00000007e001ffff81f81ffe001ffe001ffe07e00000007e7e00000007e001ffff81f81ffe001ffe001ffe07e00000007e7e00000007e001ffff81f81ffe001ffe001ffe07e00000007e7e00000007e001ffff81f81ffe001ffe001ffe07e00000007e7e00000007e001ffff81f81ffe001ffe001ffe07e00000007e7fffffffffe07e07e07e07e07e07e07e07e07e07fffffffffe7fffffffffe07e07e07e07e07e07e07e07e07e07fffffffffe7fffffffffe07e07e07e07e07e07e07e07e07e07fffffffffe7fffffffffe07e07e07e07e07e07e07e07e07e07fffffffffe7fffffffffe07e07e07e07e07e07e07e07e07e07fffffffffe7fffffffffe07e07e07e07e07e07e07e07e07e07fffffffffe00000000000001ffffffffff81fffffff81f8000000000000000000000000001ffffffffff81fffffff81f8000000000000000000000000001ffffffffff81fffffff81f8000000000000000000000000001ffffffffff81fffffff81f8000000000000000000000000001ffffffffff81fffffff81f8000000000000000000000000001ffffffffff81fffffff81f800000000000007e07e07e07e001ffe001f8007ff81ffff81ffe00007e001f807e07e07e07e001ffe001f8007ff81ffff81ffe00007e001f807e07e07e07e001ffe001f8007ff81ffff81ffe00007e001f807e07e07e07e001ffe001f8007ff81ffff81ffe00007e001f807e07e07e07e001ffe001f8007ff81ffff81ffe00007e001f807e07e07e07e001ffe001f8007ff81ffff81ffe00007e001f8001fffffff81f8007e07ff8007ff80001ffe07fffff8000007e01fffffff81f8007e07ff8007ff80001ffe07fffff8000007e01fffffff81f8007e07ff8007ff80001ffe07fffff8000007e01fffffff81f8007e07ff8007ff80001ffe07fffff8000007e01fffffff81f8007e07ff8007ff80001ffe07fffff8000007e01fffffff81f8007e07ff8007ff80001ffe07fffff8000007e0007fffe07fffe001f8007e00000000000007fffff8007fffe0007fffe07fffe001f8007e00000000000007fffff8007fffe0007fffe07fffe001f8007e00000000000007fffff8007fffe0007fffe07fffe001f8007e00000000000007fffff8007fffe0007fffe07fffe001f8007e00000000000007fffff8007fffe0007fffe07fffe001f8007e00000000000007fffff8007fffe7fffe000001ffe07e07fffe001f81fffffe07e00007e0000007fffe000001ffe07e07fffe001f81fffffe07e00007e0000007fffe000001ffe07e07fffe001f81fffffe07e00007e0000007fffe000001ffe07e07fffe001f81fffffe07e00007e0000007fffe000001ffe07e07fffe001f81fffffe07e00007e0000007fffe000001ffe07e07fffe001f81fffffe07e00007e0000007ff8007e07fffff8007e07e07ff80001f81fffffe001f800007ff8007e07fffff8007e07e07ff80001f81fffffe001f800007ff8007e07fffff8007e07e07ff80001f81fffffe001f800007ff8007e07fffff8007e07e07ff80001f81fffffe001f800007ff8007e07fffff8007e07e07ff80001f81fffffe001f800007ff8007e07fffff8007e07e07ff80001f81fffffe001f800007e07e07ff81f81f81ffe07fffe07e001f8007e07e001f8007e7e07e07ff81f81f81ffe07fffe07e001f8007e07e001f8007e7e07e07ff81f81f81ffe07fffe07e001f8007e07e001f8007e7e07e07ff81f81f81ffe07fffe07e001f8007e07e001f8007e7e07e07ff81f81f81ffe07fffe07e001f8007e07e001f8007e7e07e07ff81f81f81ffe07fffe07e001f8007e07e001f8007e7fffff8007fffffffffff81ffff8000000007ff81ffff81ffe7fffff8007fffffffffff81ffff8000000007ff81ffff81ffe7fffff8007fffffffffff81ffff8000000007ff81ffff81ffe7fffff8007fffffffffff81ffff8000000007ff81ffff81ffe7fffff8007fffffffffff81ffff8000000007ff81ffff81ffe7fffff8007fffffffffff81ffff8000000007ff81ffff81ffe00000000001ffff8007fffe07ff81ffff8007e07fffe001f8000000000001ffff8007fffe07ff81ffff8007e07fffe001f8000000000001ffff8007fffe07ff81ffff8007e07fffe001f8000000000001ffff8007fffe07ff81ffff8007e07fffe001f8000000000001ffff8007fffe07ff81ffff8007e07fffe001f8000000000001ffff8007fffe07ff81ffff8007e07fffe001f8001ffe00007e07ff80000001fffffe07ff81fffffe00000000001ffe00007e07ff80000001fffffe07ff81fffffe00000000001ffe00007e07ff80000001fffffe07ff81fffffe00000000001ffe00007e07ff80000001fffffe07ff81fffffe00000000001ffe00007e07ff80000001fffffe07ff81fffffe00000000001ffe00007e07ff80000001fffffe07ff81fffffe0000000007e00007e001f81ffe07e07e07ff8007ff80001ffff80001ffe7e00007e001f81ffe07e07e07ff8007ff80001ffff80001ffe7e00007e001f81ffe07e07e07ff8007ff80001ffff80001ffe7e00007e001f81ffe07e07e07ff8007ff80001ffff80001ffe7e00007e001f81ffe07e07e07ff8007ff80001ffff80001ffe7e00007e001f81ffe07e07e07ff8007ff80001ffff80001ffe7ff81fffffff81f8007ff8007fffe07e00007fffe00007fffe7ff81fffffff81f8007ff8007fffe07e00007fffe00007fffe7ff81fffffff81f8007ff8007fffe07e00007fffe00007fffe7ff81fffffff81f8007ff8007fffe07e00007fffe00007fffe7ff81fffffff81f8007ff8007fffe07e00007fffe00007fffe7ff81fffffff81f8007ff8007fffe07e00007fffe00007fffe7ff81f80000001ffff80000001f81fffffff8007fffe001f807ff81f80000001ffff80000001f81fffffff8007fffe001f807ff81f80000001ffff80000001f81fffffff8007fffe001f807ff81f80000001ffff80000001f81fffffff8007fffe001f807ff81f80000001ffff80000001f81fffffff8007fffe001f807ff81f80000001ffff80000001f81fffffff8007fffe001f8001f80001ffe07fffff81f8007ff8007e00007e07e001f81ffe01f80001ffe07fffff81f8007ff8007e00007e07e001f81ffe01f80001ffe07fffff81f8007ff8007e00007e07e001f81ffe01f80001ffe07fffff81f8007ff8007e00007e07e001f81ffe01f80001ffe07fffff81f8007ff8007e00007e07e001f81ffe01f80001ffe07fffff81f8007ff8007e00007e07e001f81ffe01ffe000001f81ffff81ffff8000007e00007e07e000001ffe01ffe000001f81ffff81ffff8000007e00007e07e000001ffe01ffe000001f81ffff81ffff8000007e00007e07e000001ffe01ffe000001f81ffff81ffff8000007e00007e07e000001ffe01ffe000001f81ffff81ffff8000007e00007e07e000001ffe01ffe000001f81ffff81ffff8000007e00007e07e000001ffe7e001f81ffe00000007fffe001f8007e07e001ffe001fffffe7e001f81ffe00000007fffe001f8007e07e001ffe001fffffe7e001f81ffe00000007fffe001f8007e07e001ffe001fffffe7e001f81ffe00000007fffe001f8007e07e001ffe001fffffe7e001f81ffe00000007fffe001f8007e07e001ffe001fffffe7e001f81ffe00000007fffe001f8007e07e001ffe001fffffe01f81ffe001f8007ff8007e07ffffffffffffe000000001ffe01f81ffe001f8007ff8007e07ffffffffffffe000000001ffe01f81ffe001f8007ff8007e07ffffffffffffe000000001ffe01f81ffe001f8007ff8007e07ffffffffffffe000000001ffe01f81ffe001f8007ff8007e07ffffffffffffe000000001ffe01f81ffe001f8007ff8007e07ffffffffffffe000000001ffe7e001ffe07ff81f81f81ffe001f8007ff8007fffffffffe0007e001ffe07ff81f81f81ffe001f8007ff8007fffffffffe0007e001ffe07ff81f81f81ffe001f8007ff8007fffffffffe0007e001ffe07ff81f81f81ffe001f8007ff8007fffffffffe0007e001ffe07ff81f81f81ffe001f8007ff8007fffffffffe0007e001ffe07ff81f81f81ffe001f8007ff8007fffffffffe0000000000000007fffe00000007e00007ff8007e00007ff81ffe0000000000007fffe00000007e00007ff8007e00007ff81ffe0000000000007fffe00000007e00007ff8007e00007ff81ffe0000000000007fffe00000007e00007ff8007e00007ff81ffe0000000000007fffe00000007e00007ff8007e00007ff81ffe0000000000007fffe00000007e00007ff8007e00007ff81ffe7fffffffffe000001ffe07e00007e07ffffffe07e07e07fffe7fffffffffe000001ffe07e00007e07ffffffe07e07e07fffe7fffffffffe000001ffe07e00007e07ffffffe07e07e07fffe7fffffffffe000001ffe07e00007e07ffffffe07e07e07fffe7fffffffffe000001ffe07e00007e07ffffffe07e07e07fffe7fffffffffe000001ffe07e00007e07ffffffe07e07e07fffe7e00000007e001ffe00007ffffffe07fffe07e00007e001ffe7e00000007e001ffe00007ffffffe07fffe07e00007e001ffe7e00000007e001ffe00007ffffffe07fffe07e00007e001ffe7e00000007e001ffe00007ffffffe07fffe07e00007e001ffe7e00000007e001ffe00007ffffffe07fffe07e00007e001ffe7e00000007e001ffe00007ffffffe07fffe07e00007e001ffe7e07fffe07e07ff81f8007e07ff81ffff8007ffffffff81f807e07fffe07e07ff81f8007e07ff81ffff8007ffffffff81f807e07fffe07e07ff81f8007e07ff81ffff8007ffffffff81f807e07fffe07e07ff81f8007e07ff81ffff8007ffffffff81f807e07fffe07e07ff81f8007e07ff81ffff8007ffffffff81f807e07fffe07e07ff81f8007e07ff81ffff8007ffffffff81f807e07fffe07e001ffe001ffe07e00007ff81ffe00007e07e07e7e07fffe07e001ffe001ffe07e00007ff81ffe00007e07e07e7e07fffe07e001ffe001ffe07e00007ff81ffe00007e07e07e7e07fffe07e001ffe001ffe07e00007ff81ffe00007e07e07e7e07fffe07e001ffe001ffe07e00007ff81ffe00007e07e07e7e07fffe07e001ffe001ffe07e00007ff81ffe00007e07e07e7e07fffe07e07e07fffe07e07e00000007e07ff8007ff8007e7e07fffe07e07e07fffe07e07e00000007e07ff8007ff8007e7e07fffe07e07e07fffe07e07e00000007e07ff8007ff8007e7e07fffe07e07e07fffe07e07e00000007e07ff8007ff8007e7e07fffe07e07e07fffe07e07e00000007e07ff8007ff8007e7e07fffe07e07e07fffe07e07e00000007e07ff8007ff8007e7e00000007e001ffff8007e07fffe07fffe07e07e07e001f807e00000007e001ffff8007e07fffe07fffe07e07e07e001f807e00000007e001ffff8007e07fffe07fffe07e07e07e001f807e00000007e001ffff8007e07fffe07fffe07e07e07e001f807e00000007e001ffff8007e07fffe07fffe07e07e07e001f807e00000007e001ffff8007e07fffe07fffe07e07e07e001f807fffffffffe07e07e00007fffff81ffff81ffff8007ff81ffe7fffffffffe07e07e00007fffff81ffff81ffff8007ff81ffe7fffffffffe07e07e00007fffff81ffff81ffff8007ff81ffe7fffffffffe07e07e00007fffff81ffff81ffff8007ff81ffe7fffffffffe07e07e00007fffff81ffff81ffff8007ff81ffe7fffffffffe07e07e00007fffff81ffff81ffff8007ff81ffe000000000000000000000000000000000000000000000000000d0a5420596148656932342030203438322035363820737472696e670d0a';

    final XmlDocument xml = XmlDocument.parse(testXml);

    var control = ControlBase.create(xml.rootElement);
    var dataObj = json.decode(dataSourceText);
    var dataSource = DataSource(dataObj);
    control.setDataSource(dataSource);

    CPCLCanvas canvas = CPCLCanvas();
    canvas.config = canvas.config!.copyWith(
        fontStyle: canvas.config!.fontStyle!.copyWith(fontType: 'FONT001'));
    control.performLayout(PrinterConstraints(maxWidth: 800), canvas);
    canvas.pageSize = control.actualSize;
    canvas.reset();

    control.paint(canvas, PrinterOffset.zero);

    var buffer = canvas.toCommand();

    var data = buffer.map((e) {
      var str = e.toRadixString(16);
      if (str.length == 1) {
        str = '0' + str;
      }
      return str;
    }).join();
    expect(command, data);
  });
}
